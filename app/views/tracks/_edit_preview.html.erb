<div class="navbar navbar-expand-sm navbar-light navbar-lewagon mx-4 py-3 ">
  <div>
    <%= link_to "< Back to edit mode", edit_track_path(@track), class:"text-decoration-none text-dark" %>
  </div>
  <%= link_to "Publish", "#", class: "mx-1 btn btn-yellow"%>
</div>
<div class="d-flex justify-content-center p-5">
  <div class="smartphone bg-white">
    <div class="inside-content overflow-auto" id="preview-body">
    <% if !@track.chapters.last.nil? %>
      <div class="p-3 d-flex justify-content-between align-text-top">
        <% if @track.photo.attached? %>
          <%= cl_image_tag @track.photo.key, style:"width: 15%; height: auto; object-fit: contain; object-position: center;", class:"rounded-circle" %>
        <% else %>
          <%= image_tag "logo.jpg", alt: "alttext", style:"height: auto; width: 15%; object-fit: contain; object-position: center", class:"rounded-circle" %>
        <% end %>
        <p>Mon statut</p>
      </div>
      <div class="p-3">
        <div class="progress">
          <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 75%"></div>
        </div>
      </div>
      <div class="p-2">
        <div class="track-title text-center">
          <h4 class="font-weight-bold"><%= @track.title %></h4>
          Choose your chapter!
        </div>
        <% @track.chapters.each do |chapter| %>
          <div class="chapter-tab" data-target="#chapter-content-<%= chapter.id %>">
            <%= chapter.title %>
          </div>
          <div id="chapter-content-<%= chapter.id %>" class="chapter-content" style="display: none;">
            <div class="d-flex sticky-top py-2" style="background-color: rgba(255,255,255,0.9);">
              <div class="back-chapters btn btn-primary mr-2" style="">
                <
              </div>
              <h4 style="font-weight: bold;"><%= chapter.title %></h4>
            </div>
            <div id="chapter-body" style="text-align: justify; text-justify: word-spacing;">
              <%= chapter.content %>
            </div>
            <div class="sticky-bottom" style="margin-top:20px;">
              <button class="btn-disabled">Got it!</button>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
    </div>
  </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>

<script>
  $(document).ready(function(){
    console.log($('#pills-tab'));
    $('.chapter-tab').click(function() {
      const target = $(this)[0].dataset.target;
      $(target).show();
      $('.chapter-tab').hide();
      $('.track-title').hide();
      $('.back-chapters').show();
    });
    $('.back-chapters').click(function() {
      $('.chapter-tab').show();
      $('.track-title').show();
      $('.chapter-content').hide();
      $('.back-chapters').hide();
    });
  });

  $('.inside-content').scroll(function() {
    const button = $('.btn-disabled');
    if($('.inside-content').scrollTop() >= ($('.inside-content').height())*0.5) {
      button.removeClass('btn-disabled').addClass("btn-active");
      console.log('scroll en cours');
    } else {
      button.removeClass("btn-active").addClass('btn-disabled');
    }
  });

</script>
