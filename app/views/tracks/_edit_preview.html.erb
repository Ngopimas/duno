<div class="navbar navbar-expand-sm navbar-light navbar-lewagon mx-4 py-3 ">
  <div>
    <%= link_to "< Back to edit mode", edit_track_path(@track), class:"text-decoration-none text-dark" %>
  </div>
  <%= link_to "Publish", "#", class: "mx-1 btn btn-yellow"%>
</div>
<div class="d-flex justify-content-center p-5">
  <div class="smartphone bg-white">
    <div class="inside-content" style="height: 500px" id="preview-body">
    <% if !@track.chapters.last.nil? %>
      <div class="preview-header bg-white">
        <%= render 'tracks/edit_preview_header' %>
        <div class="track-title text-center mb-4">
          <h4 class="font-weight-bold"><%= @track.title %></h4>
          Choose your chapter!
        </div>
      </div>
      <div class="p-2">
        <% @track.chapters.each do |chapter| %>
          <div class="chapter-tab" data-target="#chapter-content-<%= chapter.id %>">
            <div class="card p-3 my-2">
              <%= chapter.title %>
            </div>
          </div>
          <div id="chapter-content-<%= chapter.id %>" class="chapter-content" style="display: none;">
            <div class="d-flex sticky-top py-2" style="background-color: rgba(255,255,255,0.9);">
              <div class="back-chapters btn font-weight-bold btn-mr-2" style="color:#FFCD00; font-size:1.5em;">
                <
              </div>
              <h4 style="font-weight: bold;"><%= chapter.title %></h4>
            </div>
            <div id="chapter-body" style="text-align: justify; text-justify: word-spacing;">
              <%= chapter.content %>
            </div>
            <div class="sticky-bottom" style="margin-top:20px;">
              <% @subscription = current_user.subscriptions.where(track: @track) %>
              <% @my_chapter_subscription = ChapterSubscription.where(subscription: @subscription, chapter: chapter).last %>
              <% if @my_chapter_subscription.read == false %>
                <%= link_to "Got it!", chapter_subscription_path(@my_chapter_subscription), method: "patch", class:"btn btn-primary btn-lg w-100 undo-btn", id: "#{@my_chapter_subscription.id}", remote: true %>
              <% else %>
                <%= link_to "Undo", chapter_subscription_path(@my_chapter_subscription), method: "patch", class:"btn btn-secondary btn-lg w-100 undo-btn", id: "#{@my_chapter_subscription.id}", remote: true %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
    </div>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>

<script>
  $(document).ready(function(){
    $('.chapter-tab').click(function() {
      const target = $(this)[0].dataset.target;
      $(target).show();
      $(".current-chapter").removeClass("current-chapter");
      $(target)[0].classList.add("current-chapter");
      $('.chapter-tab').hide();
      $('.track-title').hide();
      $('.back-chapters').show();
    });
    $('.back-chapters').click(function() {
      $('.chapter-tab').show();
      $('.track-title').show();
      $('.chapter-content').hide();
      $('.back-chapters').hide();
    });
  });

  $('.inside-content').scroll(function() {
    const button = $('.btn-disabled');
    button.removeClass('btn-disabled').addClass("btn-active");
  });

</script>

